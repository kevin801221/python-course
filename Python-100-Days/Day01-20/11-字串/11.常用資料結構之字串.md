## 常用資料結構之字串

第二次世界大戰促使了現代電子計算機的誕生，世界上的第一臺通用電子計算機名叫 ENIAC（電子數值積分計算機），誕生於美國的賓夕法尼亞大學，佔地 167 平米，重量約 27 噸，每秒鐘大約能夠完成約 5000 次浮點運算，如下圖所示。ENIAC 誕生之後被應用於導彈彈道的計算，而數值計算也是現代電子計算機最為重要的一項功能。

<img src="../res/day11/eniac.jpg" style="zoom:50%;">

隨著時間的推移，雖然數值運算仍然是計算機日常工作中最為重要的組成部分，但是今天的計算機還要處理大量的以文字形式存在的資訊。如果我們希望透過 Python 程式來操作本這些文字資訊，就必須要先了解字串這種資料型別以及與它相關的運算和方法。

### 字串的定義

所謂**字串**，就是**由零個或多個字元組成的有限序列**，一般記為：

$$
s = a_1a_2 \cdots a_n \,\,\,\,\, (0 \le n \le \infty)
$$

在 Python 程式中，我們把單個或多個字元用單引號或者雙引號包圍起來，就可以表示一個字串。字串中的字元可以是特殊符號、英文字母、中文字元、日文的平假名或片假名、希臘字母、Emoji 字元（如：💩、🐷、🀄️）等。

```python
s1 = 'hello, world!'
s2 = "你好，世界！❤️"
s3 = '''hello,
wonderful
world!'''
print(s1)
print(s2)
print(s3)
```

#### 跳脫字元

我們可以在字串中使用`\`（反斜槓）來表示轉義，也就是說`\`後面的字元不再是它原來的意義，例如：`\n`不是代表字元`\`和字元`n`，而是表示換行；`\t`也不是代表字元`\`和字元`t`，而是表示製表符。所以如果字串本身又包含了`'`、`"`、`\`這些特殊的字元，必須要透過`\`進行轉義處理。例如要輸出一個帶單引號或反斜槓的字串，需要用如下所示的方法。

```python
s1 = '\'hello, world!\''
s2 = '\\hello, world!\\'
print(s1)
print(s2)
```

#### 原始字串

Python 中有一種以`r`或`R`開頭的字串，這種字串被稱為原始字串，意思是字串中的每個字元都是它本來的含義，沒有所謂的跳脫字元。例如，在字串`'hello\n'`中，`\n`表示換行；而在`r'hello\n'`中，`\n`不再表示換行，就是字元`\`和字元`n`。大家可以執行下面的程式碼，看看會輸出什麼。

```python
s1 = '\it \is \time \to \read \now'
s2 = r'\it \is \time \to \read \now'
print(s1)
print(s2)
```

> **說明**：上面的變數`s1`中，`\t`、`\r`和`\n`都是跳脫字元。`\t`是製表符（table），`\n`是換行符（new line），`\r`是回車符（carriage return）相當於讓輸出回到了行首。對比一下兩個`print`函式的輸出，看看到底有什麼區別！

#### 字元的特殊表示

Python 中還允許在`\`後面還可以跟一個八進位制或者十六進位制數來表示字元，例如`\141`和`\x61`都代表小寫字母`a`，前者是八進位制的表示法，後者是十六進位制的表示法。另外一種表示字元的方式是在`\u`後面跟 Unicode 字元編碼，例如`\u9a86\u660a`代表的是中文“Kevin”。執行下面的程式碼，看看輸出了什麼。

```python
s1 = '\141\142\143\x61\x62\x63'
s2 = '\u9a86\u660a'
print(s1)
print(s2)
```

### 字串的運算

Python 語言為字串型別提供了非常豐富的運算子，有很多運算子跟列表型別的運算子作用類似。例如，我們可以使用`+`運算子來實現字串的拼接，可以使用`*`運算子來重複一個字串的內容，可以使用`in`和`not in`來判斷一個字串是否包含另外一個字串，我們也可以用`[]`和`[:]`運算子從字串取出某個字元或某些字元。

#### 拼接和重複

下面的例子演示了使用`+`和`*`運算子來實現字串的拼接和重複操作。

```python
s1 = 'hello' + ', ' + 'world'
print(s1)    # hello, world
s2 = '!' * 3
print(s2)    # !!!
s1 += s2
print(s1)    # hello, world!!!
s1 *= 2
print(s1)    # hello, world!!!hello, world!!!
```

用`*`實現字串的重複是非常有意思的一個運算子，在很多程式語言中，要表示一個有10個`a`的字串，你只能寫成`'aaaaaaaaaa'`，但是在 Python 中，你可以寫成`'a' * 10`。你可能覺得`'aaaaaaaaaa'`這種寫法也沒有什麼不方便的，但是請想一想，如果字元`a`要重複100次或者1000次又會如何呢？

#### 比較運算

對於兩個字串型別的變數，可以直接使用比較運算子來判斷兩個字串的相等性或比較大小。需要說明的是，因為字串在計算機記憶體中也是以二進位制形式存在的，那麼字串的大小比較比的是每個字元對應的編碼的大小。例如`A`的編碼是`65`， 而`a`的編碼是`97`，所以`'A' < 'a'`的結果相當於就是`65 < 97`的結果，這裡很顯然是`True`；而`'boy' < 'bad'`，因為第一個字元都是`'b'`比不出大小，所以實際比較的是第二個字元的大小，顯然`'o' < 'a'`的結果是`False`，所以`'boy' < 'bad'`的結果是`False`。如果不清楚兩個字元對應的編碼到底是多少，可以使用`ord`函式來獲得，之前我們有提到過這個函式。例如`ord('A')`的值是`65`，而`ord('昊')`的值是`26122`。下面的程式碼展示了字串的比較運算，請大家仔細看看。

```python
s1 = 'a whole new world'
s2 = 'hello world'
print(s1 == s2)             # False
print(s1 < s2)              # True
print(s1 == 'hello world')  # False
print(s2 == 'hello world')  # True
print(s2 != 'Hello world')  # True
s3 = 'Kevin'
print(ord('駱'))            # 39558
print(ord('昊'))            # 26122
s4 = '王大錘'
print(ord('王'))            # 29579
print(ord('大'))            # 22823
print(ord('錘'))            # 38180
print(s3 >= s4)             # True
print(s3 != s4)             # True
```

#### 成員運算

Python 中可以用`in`和`not in`判斷一個字串中是否包含另外一個字元或字串，跟列表型別一樣，`in`和`not in`稱為成員運算子，會產生布林值`True`或`False`，程式碼如下所示。

```python
s1 = 'hello, world'
s2 = 'goodbye, world'
print('wo' in s1)      # True
print('wo' not in s2)  # False
print(s2 in s1)        # False
```

#### 獲取字串長度

獲取字串長度跟獲取列表元素個數一樣，使用內建函式`len`，程式碼如下所示。

```python
s = 'hello, world'
print(len(s))                 # 12
print(len('goodbye, world'))  # 14
```

#### 索引和切片

字串的索引和切片操作跟列表、元組幾乎沒有區別，因為字串也是一種有序序列，可以透過正向或反向的整數索引訪問其中的元素。但是有一點需要注意，因為**字串是不可變型別**，所以**不能透過索引運算修改字串中的字元**。

```python
s = 'abc123456'
n = len(s)
print(s[0], s[-n])    # a a
print(s[n-1], s[-1])  # 6 6
print(s[2], s[-7])    # c c
print(s[5], s[-4])    # 3 3
print(s[2:5])         # c12
print(s[-7:-4])       # c12
print(s[2:])          # c123456
print(s[:2])          # ab
print(s[::2])         # ac246
print(s[::-1])        # 654321cba
```

需要再次提醒大家注意的是，在進行索引運算時，如果索引越界，會引發`IndexError`異常，錯誤提示資訊為：`string index out of range`（字串索引超出範圍）。

### 字元的遍歷

如果希望遍歷字串中的每個字元，可以使用`for-in`迴圈，有如下所示的兩種方式。

方式一：

```python
s = 'hello'
for i in range(len(s)):
    print(s[i])
```

方式二：

```python
s = 'hello'
for elem in s:
    print(elem)
```

### 字串的方法

在 Python 中，我們可以透過字串型別自帶的方法對字串進行操作和處理，假設我們有名為`foo`的字串，字串有名為`bar`的方法，那麼使用字串方法的語法是：`foo.bar()`，這是一種透過物件引用呼叫物件方法的語法，跟前面使用列表方法的語法是一樣的。

#### 大小寫相關操作

下面的程式碼演示了和字串大小寫變換相關的方法。

```python
s1 = 'hello, world!'
# 字串首字母大寫
print(s1.capitalize())  # Hello, world!
# 字串每個單詞首字母大寫
print(s1.title())       # Hello, World!
# 字串變大寫
print(s1.upper())       # HELLO, WORLD!
s2 = 'GOODBYE'
# 字串變小寫
print(s2.lower())       # goodbye
# 檢查s1和s2的值
print(s1)               # hello, world
print(s2)               # GOODBYE
```

> **說明**：由於字串是不可變型別，使用字串的方法對字串進行操作會產生新的字串，但是原來變數的值並沒有發生變化。所以上面的程式碼中，當我們最後檢查`s1`和`s2`兩個變數的值時，`s1`和`s2` 的值並沒有發生變化。

#### 查詢操作

如果想在一個字串中從前向後查詢有沒有另外一個字串，可以使用字串的`find`或`index`方法。在使用`find`和`index`方法時還可以透過方法的引數來指定查詢的範圍，也就是查詢不必從索引為`0`的位置開始。

```python
s = 'hello, world!'
print(s.find('or'))      # 8
print(s.find('or', 9))   # -1
print(s.find('of'))      # -1
print(s.index('or'))     # 8
print(s.index('or', 9))  # ValueError: substring not found
```

>**說明**：`find`方法找不到指定的字串會返回`-1`，`index`方法找不到指定的字串會引發`ValueError`錯誤。

`find`和`index`方法還有逆向查詢（從後向前查詢）的版本，分別是`rfind`和`rindex`，程式碼如下所示。

```python
s = 'hello world!'
print(s.find('o'))       # 4
print(s.rfind('o'))      # 7
print(s.rindex('o'))     # 7
# print(s.rindex('o', 8))  # ValueError: substring not found
```

#### 性質判斷

可以透過字串的`startswith`、`endswith`來判斷字串是否以某個字串開頭和結尾；還可以用`is`開頭的方法判斷字串的特徵，這些方法都返回布林值，程式碼如下所示。

```python
s1 = 'hello, world!'
print(s1.startswith('He'))   # False
print(s1.startswith('hel'))  # True
print(s1.endswith('!'))      # True
s2 = 'abc123456'
print(s2.isdigit())  # False
print(s2.isalpha())  # False
print(s2.isalnum())  # True
```

> **說明**：上面的`isdigit`用來判斷字串是不是完全由數字構成的，`isalpha`用來判斷字串是不是完全由字母構成的，這裡的字母指的是 Unicode 字元但不包含 Emoji 字元，`isalnum`用來判斷字串是不是由字母和數字構成的。

#### 格式化

在 Python 中，字串型別可以透過`center`、`ljust`、`rjust`方法做居中、左對齊和右對齊的處理。如果要在字串的左側補零，也可以使用`zfill`方法。

```python
s = 'hello, world'
print(s.center(20, '*'))  # ****hello, world****
print(s.rjust(20))        #         hello, world
print(s.ljust(20, '~'))   # hello, world~~~~~~~~
print('33'.zfill(5))      # 00033
print('-33'.zfill(5))     # -0033
```

我們之前講過，在用`print`函式輸出字串時，可以用下面的方式對字串進行格式化。

```python
a = 321
b = 123
print('%d * %d = %d' % (a, b, a * b))
```

當然，我們也可以用字串的`format`方法來完成字串的格式，程式碼如下所示。

```python
a = 321
b = 123
print('{0} * {1} = {2}'.format(a, b, a * b))
```

從 Python 3.6 開始，格式化字串還有更為簡潔的書寫方式，就是在字串前加上`f`來格式化字串，在這種以`f`打頭的字串中，`{變數名}`是一個佔位符，會被變數對應的值將其替換掉，程式碼如下所示。

```python
a = 321
b = 123
print(f'{a} * {b} = {a * b}')
```

如果需要進一步控制格式化語法中變數值的形式，可以參照下面的表格來進行字串格式化操作。

| 變數值      | 佔位符     | 格式化結果    | 說明 |
| ----------- | ---------- | ------------- | ---- |
| `3.1415926` | `{:.2f}`   | `'3.14'`      | 保留小數點後兩位 |
| `3.1415926` | `{:+.2f}`  | `'+3.14'`       | 帶符號保留小數點後兩位 |
| `-1`        | `{:+.2f}`  | `'-1.00'` | 帶符號保留小數點後兩位 |
| `3.1415926` | `{:.0f}`   | `'3'` | 不帶小數 |
| `123`       | `{:0>10d}` | `'0000000123'` | 左邊補`0`，補夠10位 |
| `123`       | `{:x<10d}` | `'123xxxxxxx'` | 右邊補`x` ，補夠10位 |
| `123`       | `{:>10d}`  | `'       123'` | 左邊補空格，補夠10位 |
| `123`       | `{:<10d}` | `'123       '` | 右邊補空格，補夠10位 |
| `123456789` | `{:,}`     | `'123,456,789'` | 逗號分隔格式 |
| `0.123`     | `{:.2%}`   | `'12.30%'`    | 百分比格式 |
| `123456789` | `{:.2e}`   | `'1.23e+08'`  | 科學計數法格式 |

#### 修剪操作

字串的`strip`方法可以幫我們獲得將原字串修剪掉左右兩端指定字元之後的字串，預設是修剪空格字元。這個方法非常有實用價值，可以用來將使用者輸入時不小心鍵入的頭尾空格等去掉，`strip`方法還有`lstrip`和`rstrip`兩個版本，相信從名字大家已經猜出來這兩個方法是做什麼用的。

```python
s1 = '   jackfrued@126.com  '
print(s1.strip())      # jackfrued@126.com
s2 = '~你好，世界~'
print(s2.lstrip('~'))  # 你好，世界~
print(s2.rstrip('~'))  # ~你好，世界
```

#### 替換操作

如果希望用新的內容替換字串中指定的內容，可以使用`replace`方法，程式碼如下所示。`replace`方法的第一個引數是被替換的內容，第二個引數是替換後的內容，還可以透過第三個引數指定替換的次數。

```python
s = 'hello, good world'
print(s.replace('o', '@'))     # hell@, g@@d w@rld
print(s.replace('o', '@', 1))  # hell@, good world
```

#### 拆分與合併

可以使用字串的`split`方法將一個字串拆分為多個字串（放在一個列表中），也可以使用字串的`join`方法將列表中的多個字串連線成一個字串，程式碼如下所示。

```python
s = 'I love you'
words = s.split()
print(words)            # ['I', 'love', 'you']
print('~'.join(words))  # I~love~you
```

需要說明的是，`split`方法預設使用空格進行拆分，我們也可以指定其他的字元來拆分字串，而且還可以指定最大拆分次數來控制拆分的效果，程式碼如下所示。

```python
s = 'I#love#you#so#much'
words = s.split('#')
print(words)  # ['I', 'love', 'you', 'so', 'much']
words = s.split('#', 2)
print(words)  # ['I', 'love', 'you#so#much']
```

#### 編碼和解碼

Python 中除了字串`str`型別外，還有一種表示二進位制資料的位元組串型別（`bytes`）。所謂位元組串，就是**由零個或多個位元組組成的有限序列**。透過字串的`encode`方法，我們可以按照某種編碼方式將字串編碼為位元組串，我們也可以使用位元組串的`decode`方法，將位元組串解碼為字串，程式碼如下所示。

```python
a = 'Kevin'
b = a.encode('utf-8')
c = a.encode('gbk')
print(b)                  # b'\xe9\xaa\x86\xe6\x98\x8a'
print(c)                  # b'\xc2\xe6\xea\xbb'
print(b.decode('utf-8'))  # Kevin
print(c.decode('gbk'))    # Kevin
```

注意，如果編碼和解碼的方式不一致，會導致亂碼問題（無法再現原始的內容）或引發`UnicodeDecodeError`錯誤，導致程式崩潰。

#### 其他方法

對於字串型別來說，還有一個常用的操作是對字串進行匹配檢查，即檢查字串是否滿足某種特定的模式。例如，一個網站對使用者註冊資訊中使用者名稱和郵箱的檢查，就屬於模式匹配檢查。實現模式匹配檢查的工具叫做正規表示式，Python 語言透過標準庫中的`re`模組提供了對正規表示式的支援，我們會在後續的課程中為大家講解這個知識點。

### 總結

知道如何表示和操作字串對程式設計師來說是非常重要的，因為我們經常需要處理文字資訊，Python 中操作字串可以用拼接、索引、切片等運算子，也可以使用字串型別提供的非常豐富的方法。
