## 常用資料結構之字典

迄今為止，我們已經為大家介紹了 Python 中的三種容器型資料型別（列表、元組、集合），但是這些資料型別仍然不足以幫助我們解決所有的問題。例如，我們需要一個變數來儲存一個人的多項資訊，包括：姓名、年齡、身高、體重、家庭住址、本人手機號、緊急聯絡人手機號，此時你會發現，我們之前學過的列表、元組和集合型別都不夠好使。

```python
person1 = ['王大錘', 55, 168, 60, '成都市武侯區科華北路62號1棟101', '13122334455', '13800998877']
person2 = ('王大錘', 55, 168, 60, '成都市武侯區科華北路62號1棟101', '13122334455', '13800998877')
person3 = {'王大錘', 55, 168, 60, '成都市武侯區科華北路62號1棟101', '13122334455', '13800998877'}
```

集合肯定是最不合適的，因為集合中不能有重複元素，如果一個人的年齡和體重剛好相同，那麼集合中就會少一項資訊；同理，如果這個人的手機號和緊急聯絡人手機號是相同的，那麼集合中又會少一項資訊。另一方面，雖然列表和元組可以把一個人的所有資訊都儲存下來，但是當你想要獲取這個人的手機號或家庭住址時，你得先知道他的手機號是列表或元組中的第幾個元素。總之，在遇到上述的場景時，列表、元組、集合都不是最合適的選擇，此時我們需要字典（dictionary）型別，這種資料型別最適合把相關聯的資訊組裝到一起，可以幫助我們解決 Python 程式中為真實事物建模的問題。

說到字典這個詞，大家一定不陌生，讀小學的時候，每個人手頭基本上都有一本《新華字典》，如下圖所示。

<img src="res/day13/xinhua_dictionary.jpg" style="zoom:80%;">

Python 程式中的字典跟現實生活中的字典很像，它以鍵值對（鍵和值的組合）的方式把資料組織到一起，我們可以透過鍵找到與之對應的值並進行操作。就像《新華字典》中，每個字（鍵）都有與它對應的解釋（值）一樣，每個字和它的解釋合在一起就是字典中的一個條目，而字典中通常包含了很多個這樣的條目。

### 建立和使用字典

Python 中建立字典可以使用`{}`字面量語法，這一點跟上一節課講的集合是一樣的。但是字典的`{}`中的元素是以鍵值對的形式存在的，每個元素由`:`分隔的兩個值構成，`:`前面是鍵，`:`後面是值，程式碼如下所示。

```python
xinhua = {
    '麓': '山腳下',
    '路': '道，往來通行的地方；方面，地區：南～貨，外～貨；種類：他倆是一～人',
    '蕗': '甘草的別名',
    '潞': '潞水，水名，即今山西省的濁漳河；潞江，水名，即雲南省的怒江'
}
print(xinhua)
person = {
    'name': '王大錘',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '成都市武侯區科華北路62號1棟101', 
    'tel': '13122334455',
    'emergence contact': '13800998877'
}
print(person)
```

透過上面的程式碼，相信大家已經看出來了，用字典來儲存一個人的資訊遠遠優於使用列表或元組，因為我們可以用`:`前面的鍵來表示條目的含義，而`:`後面就是這個條目所對應的值。

當然，如果願意，我們也可以使用內建函式`dict`或者是字典的生成式語法來建立字典，程式碼如下所示。

```python
# dict函式(構造器)中的每一組引數就是字典中的一組鍵值對
person = dict(name='王大錘', age=55, height=168, weight=60, addr='成都市武侯區科華北路62號1棟101')
print(person)  # {'name': '王大錘', 'age': 55, 'height': 168, 'weight': 60, 'addr': '成都市武侯區科華北路62號1棟101'}

# 可以透過Python內建函式zip壓縮兩個序列並建立字典
items1 = dict(zip('ABCDE', '12345'))
print(items1)  # {'A': '1', 'B': '2', 'C': '3', 'D': '4', 'E': '5'}
items2 = dict(zip('ABCDE', range(1, 10)))
print(items2)  # {'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5}

# 用字典生成式語法建立字典
items3 = {x: x ** 3 for x in range(1, 6)}
print(items3)  # {1: 1, 2: 8, 3: 27, 4: 64, 5: 125}
```

想知道字典中一共有多少組鍵值對，仍然是使用`len`函式；如果想對字典進行遍歷，可以用`for`迴圈，但是需要注意，`for`迴圈只是對字典的鍵進行了遍歷，不過沒關係，在學習了字典的索引運算後，我們可以透過字典的鍵訪問它對應的值。

```python
person = {
    'name': '王大錘',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '成都市武侯區科華北路62號1棟101'
}
print(len(person))  # 5
for key in person:
    print(key)
```

### 字典的運算

對於字典型別來說，成員運算和索引運算肯定是很重要的，前者可以判定指定的鍵在不在字典中，後者可以透過鍵訪問對應的值或者向字典中新增新的鍵值對。值得注意的是，字典的索引不同於列表的索引，列表中的元素因為有屬於自己有序號，所以列表的索引是一個整數；字典中因為儲存的是鍵值對，所以字典需要用鍵去索引對應的值。需要**特別提醒**大家注意的是，**字典中的鍵必須是不可變型別**，例如整數（`int`）、浮點數（`float`）、字串（`str`）、元組（`tuple`）等型別，這一點跟集合型別對元素的要求是一樣的；很顯然，之前我們講的列表（`list`）和集合（`set`）不能作為字典中的鍵，字典型別本身也不能再作為字典中的鍵，因為字典也是可變型別，但是列表、集合、字典都可以作為字典中的值，例如：

```python
person = {
    'name': '王大錘',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': ['成都市武侯區科華北路62號1棟101', '北京市西城區百萬莊大街1號'],
    'car': {
        'brand': 'BMW X7',
        'maxSpeed': '250',
        'length': 5170,
        'width': 2000,
        'height': 1835,
        'displacement': 3.0
    }
}
print(person)
```

大家可以看看下面的程式碼，瞭解一下字典的成員運算和索引運算。

```python
person = {'name': '王大錘', 'age': 55, 'height': 168, 'weight': 60, 'addr': '成都市武侯區科華北路62號1棟101'}

# 成員運算
print('name' in person)  # True
print('tel' in person)   # False

# 索引運算
print(person['name'])
print(person['addr'])
person['age'] = 25
person['height'] = 178
person['tel'] = '13122334455'
person['signature'] = '你的男朋友是一個蓋世垃圾，他會踏著五彩祥雲去迎娶你的閨蜜'
print(person)

# 迴圈遍歷
for key in person:
    print(f'{key}:\t{person[key]}')
```

需要注意，在透過索引運算獲取字典中的值時，如指定的鍵沒有在字典中，將會引發`KeyError`異常。

### 字典的方法

字典型別的方法基本上都跟字典的鍵值對操作相關，其中`get`方法可以透過鍵來獲取對應的值。跟索引運算不同的是，`get`方法在字典中沒有指定的鍵時不會產生異常，而是返回`None`或指定的預設值，程式碼如下所示。

```python
person = {'name': '王大錘', 'age': 25, 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
print(person.get('name'))       # 王大錘
print(person.get('sex'))        # None
print(person.get('sex', True))  # True
```

如果需要獲取字典中所有的鍵，可以使用`keys`方法；如果需要獲取字典中所有的值，可以使用`values`方法。字典還有一個名為`items`的方法，它會將鍵和值組裝成二元組，透過該方法來遍歷字典中的元素也是非常方便的。

```python
person = {'name': '王大錘', 'age': 25, 'height': 178}
print(person.keys())    # dict_keys(['name', 'age', 'height'])
print(person.values())  # dict_values(['王大錘', 25, 178])
print(person.items())   # dict_items([('name', '王大錘'), ('age', 25), ('height', 178)])
for key, value in person.items():
    print(f'{key}:\t{value}')
```

字典的`update`方法實現兩個字典的合併操作。例如，有兩個字典`x`和`y`，當執行`x.update(y)`操作時，`x`跟`y`相同的鍵對應的值會被`y`中的值更新，而`y`中有但`x`中沒有的鍵值對會直接新增到`x`中，程式碼如下所示。

```python
person1 = {'name': '王大錘', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '成都市武侯區科華北路62號1棟101'}
person1.update(person2)
print(person1)  # {'name': '王大錘', 'age': 25, 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
```

如果使用 Python 3.9 及以上的版本，也可以使用`|`運算子來完成同樣的操作，程式碼如下所示。

```python
person1 = {'name': '王大錘', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '成都市武侯區科華北路62號1棟101'}
person1 |= person2
print(person1)  # {'name': '王大錘', 'age': 25, 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
```

可以透過`pop`或`popitem`方法從字典中刪除元素，前者會返回（獲得）鍵對應的值，但是如果字典中不存在指定的鍵，會引發`KeyError`錯誤；後者在刪除元素時，會返回（獲得）鍵和值組成的二元組。字典的`clear`方法會清空字典中所有的鍵值對，程式碼如下所示。

```python
person = {'name': '王大錘', 'age': 25, 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
print(person.pop('age'))  # 25
print(person)             # {'name': '王大錘', 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
print(person.popitem())   # ('addr', '成都市武侯區科華北路62號1棟101')
print(person)             # {'name': '王大錘', 'height': 178}
person.clear()
print(person)             # {}
```

跟列表一樣，從字典中刪除元素也可以使用`del`關鍵字，在刪除元素的時候如果指定的鍵索引不到對應的值，一樣會引發`KeyError`錯誤，具體的做法如下所示。

```python
person = {'name': '王大錘', 'age': 25, 'height': 178, 'addr': '成都市武侯區科華北路62號1棟101'}
del person['age']
del person['addr']
print(person)  # {'name': '王大錘', 'height': 178}
```

### 字典的應用

我們透過幾個簡單的例子來看看如何使用字典型別解決一些實際的問題。

**例子1**：輸入一段話，統計每個英文字母出現的次數，按出現次數從高到低輸出。

```python
sentence = input('請輸入一段話: ')
counter = {}
for ch in sentence:
    if 'A' <= ch <= 'Z' or 'a' <= ch <= 'z':
        counter[ch] = counter.get(ch, 0) + 1
sorted_keys = sorted(counter, key=counter.get, reverse=True)
for key in sorted_keys:
    print(f'{key} 出現了 {counter[key]} 次.')
```

輸入：

```
Man is distinguished, not only by his reason, but by this singular passion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure.
```

輸出：

```
e 出現了 27 次.
n 出現了 21 次.
a 出現了 18 次.
i 出現了 18 次.
s 出現了 16 次.
t 出現了 16 次.
o 出現了 14 次.
h 出現了 13 次.
r 出現了 10 次.
d 出現了 9 次.
l 出現了 9 次.
g 出現了 6 次.
u 出現了 6 次.
f 出現了 6 次.
c 出現了 6 次.
y 出現了 5 次.
b 出現了 5 次.
m 出現了 4 次.
p 出現了 3 次.
w 出現了 2 次.
v 出現了 2 次.
M 出現了 1 次.
k 出現了 1 次.
x 出現了 1 次.
```

**例子2**：在一個字典中儲存了股票的程式碼和價格，找出股價大於100元的股票並建立一個新的字典。

> **說明**：可以用字典的生成式語法來建立這個新字典。

```python
stocks = {
    'AAPL': 191.88,
    'GOOG': 1186.96,
    'IBM': 149.24,
    'ORCL': 48.44,
    'ACN': 166.89,
    'FB': 208.09,
    'SYMC': 21.29
}
stocks2 = {key: value for key, value in stocks.items() if value > 100}
print(stocks2)
```

輸出：

```
{'AAPL': 191.88, 'GOOG': 1186.96, 'IBM': 149.24, 'ACN': 166.89, 'FB': 208.09}
```

### 總結

Python 程式中的字典跟現實生活中字典非常像，允許我們**以鍵值對的形式儲存資料**，再**透過鍵訪問對應的值**。字典是一種非常**有利於資料檢索**的資料型別，但是需要再次提醒大家，**字典中的鍵必須是不可變型別**，列表、集合、字典等型別的資料都不能作為字典的鍵。
