## 常用資料結構之元組

前面的兩節課，我們為大家講解了 Python 中的列表，它是一種容器型的資料型別，透過列表型別的變數，我們可以儲存多個資料並透過迴圈實現對資料的批次操作。當然，Python 中還有其他容器型的資料型別，接下來我們就為大家講解另一種容器型的資料型別，它的名字叫元組（tuple）。

### 元組的定義和運算

在 Python 語言中，元組也是多個元素按照一定順序構成的序列。元組和列表的不同之處在於，**元組是不可變型別**，這就意味著元組型別的變數一旦定義，其中的元素不能再新增或刪除，而且元素的值也不能修改。如果試圖修改元組中的元素，將引發`TypeError`錯誤，導致程式崩潰。定義元組通常使用形如`(x, y, z)`的字面量語法，元組型別支援的運算子跟列表是一樣的，我們可以看看下面的程式碼。

```python
# 定義一個三元組
t1 = (35, 12, 98)
# 定義一個四元組
t2 = ('Kevin', 45, True, '四川成都')

# 檢視變數的型別
print(type(t1))  # <class 'tuple'>
print(type(t2))  # <class 'tuple'>

# 檢視元組中元素的數量
print(len(t1))  # 3
print(len(t2))  # 4

# 索引運算
print(t1[0])    # 35
print(t1[2])    # 98
print(t2[-1])   # 四川成都

# 切片運算
print(t2[:2])   # ('Kevin', 43)
print(t2[::3])  # ('Kevin', '四川成都')

# 迴圈遍歷元組中的元素
for elem in t1:
    print(elem)

# 成員運算
print(12 in t1)         # True
print(99 in t1)         # False
print('Hao' not in t2)  # True

# 拼接運算
t3 = t1 + t2
print(t3)  # (35, 12, 98, 'Kevin', 43, True, '四川成都')

# 比較運算
print(t1 == t3)            # False
print(t1 >= t3)            # False
print(t1 <= (35, 11, 99))  # False
```

一個元組中如果有兩個元素，我們就稱之為二元組；一個元組中如果五個元素，我們就稱之為五元組。需要提醒大家注意的是，`()`表示空元組，但是如果元組中只有一個元素，需要加上一個逗號，否則`()`就不是代表元組的字面量語法，而是改變運算優先順序的圓括號，所以`('hello', )`和`(100, )`才是一元組，而`('hello')`和`(100)`只是字串和整數。我們可以透過下面的程式碼來加以驗證。

```python
a = ()
print(type(a))  # <class 'tuple'>
b = ('hello')
print(type(b))  # <class 'str'>
c = (100)
print(type(c))  # <class 'int'>
d = ('hello', )
print(type(d))  # <class 'tuple'>
e = (100, )
print(type(e))  # <class 'tuple'>
```

### 打包和解包操作

當我們把多個用逗號分隔的值賦給一個變數時，多個值會打包成一個元組型別；當我們把一個元組賦值給多個變數時，元組會解包成多個值然後分別賦給對應的變數，如下面的程式碼所示。

```python
# 打包操作
a = 1, 10, 100
print(type(a))  # <class 'tuple'>
print(a)        # (1, 10, 100)
# 解包操作
i, j, k = a
print(i, j, k)  # 1 10 100
```

在解包時，如果解包出來的元素個數和變數個數不對應，會引發`ValueError`異常，錯誤資訊為：`too many values to unpack`（解包的值太多）或`not enough values to unpack`（解包的值不足）。

```python
a = 1, 10, 100, 1000
# i, j, k = a             # ValueError: too many values to unpack (expected 3)
# i, j, k, l, m, n = a    # ValueError: not enough values to unpack (expected 6, got 4)
```

有一種解決變數個數少於元素的個數方法，就是使用星號表示式。透過星號表示式，我們可以讓一個變數接收多個值，程式碼如下所示。需要注意兩點：首先，用星號表示式修飾的變數會變成一個列表，列表中有0個或多個元素；其次，在解包語法中，星號表示式只能出現一次。

```python
a = 1, 10, 100, 1000
i, j, *k = a
print(i, j, k)        # 1 10 [100, 1000]
i, *j, k = a
print(i, j, k)        # 1 [10, 100] 1000
*i, j, k = a
print(i, j, k)        # [1, 10] 100 1000
*i, j = a
print(i, j)           # [1, 10, 100] 1000
i, *j = a
print(i, j)           # 1 [10, 100, 1000]
i, j, k, *l = a
print(i, j, k, l)     # 1 10 100 [1000]
i, j, k, l, *m = a
print(i, j, k, l, m)  # 1 10 100 1000 []
```

需要說明一點，解包語法對所有的序列都成立，這就意味著我們之前講的列表、`range`函式構造的範圍序列甚至字串都可以使用解包語法。大家可以嘗試執行下面的程式碼，看看會出現怎樣的結果。

```python
a, b, *c = range(1, 10)
print(a, b, c)
a, b, c = [1, 10, 100]
print(a, b, c)
a, *b, c = 'hello'
print(a, b, c)
```

### 交換變數的值

交換變數的值是寫程式碼時經常用到的一個操作，但是在很多程式語言中，交換兩個變數的值都需要藉助一箇中間變數才能做到，如果不用中間變數就需要使用比較晦澀的位運算來實現。在 Python 中，交換兩個變數`a`和`b`的值只需要使用如下所示的程式碼。

```python
a, b = b, a
```

同理，如果要將三個變數`a`、`b`、`c`的值互換，即`b`的值賦給`a`，`c`的值賦給`b`，`a`的值賦給`c`，也可以如法炮製。

```python
a, b, c = b, c, a
```

需要說明的是，上面的操作並沒有用到打包和解包語法，Python 的位元組碼指令中有`ROT_TWO`和`ROT_THREE`這樣的指令可以直接實現這個操作，效率是非常高的。但是如果有多於三個變數的值要依次互換，這個時候是沒有直接可用的位元組碼指令的，需要透過打包解包的方式來完成變數之間值的交換。

### 元組和列表的比較

這裡還有一個非常值得探討的問題，Python 中已經有了列表型別，為什麼還需要元組這樣的型別呢？這個問題對於初學者來說似乎有點困難，不過沒有關係，我們先丟擲觀點，大家可以一邊學習一邊慢慢體會。

1. 元組是不可變型別，**不可變型別更適合多執行緒環境**，因為它降低了併發訪問變數的同步化開銷。關於這一點，我們會在後面講解併發程式設計的時候跟大家一起探討。

2. 元組是不可變型別，通常**不可變型別在建立時間上優於對應的可變型別**。我們可以使用`timeit`模組的`timeit`函式來看看建立儲存相同元素的元組和列表各自花費的時間，`timeit`函式的`number`參數列示程式碼執行的次數。下面的程式碼中，我們分別建立了儲存`1`到`9`的整數的列表和元組，每個操作執行`10000000`次，統計執行時間。

   ```python
   import timeit
   
   print('%.3f 秒' % timeit.timeit('[1, 2, 3, 4, 5, 6, 7, 8, 9]', number=10000000))
   print('%.3f 秒' % timeit.timeit('(1, 2, 3, 4, 5, 6, 7, 8, 9)', number=10000000))
   ```

   輸出：

   ```
   0.635 秒
   0.078 秒
   ```

   > **說明**：上面程式碼的執行結果因軟硬體系統而異，在我目前使用的電腦上，執行`10000000`次建立列表的操作時間是`0.635`秒，而執行`10000000`次建立元組的操作時間是`0.078`秒，顯然建立元組更快且二者時間上有數量級的差別。大家可以在自己的電腦上執行這段程式碼，把你的執行結果放到評論區，看看誰的電腦更厲害。

當然，Python 中的元組和列表型別是可以相互轉換的，我們可以透過下面的程式碼來完成該操作。

```python
infos = ('Kevin', 43, True, '四川成都')
# 將元組轉換成列表
print(list(infos))  # ['Kevin', 43, True, '四川成都']

frts = ['apple', 'banana', 'orange']
# 將列表轉換成元組
print(tuple(frts))  # ('apple', 'banana', 'orange')
```

### 總結

**列表和元組都是容器型的資料型別**，即一個變數可以儲存多個資料，而且它們都是按一定順序組織元素的有序容器。**列表是可變資料型別**，**元組是不可變資料型別**，所以列表可以新增元素、刪除元素、清空元素、排序反轉，但這些操作對元組來說是不成立的。列表和元組都可以支援**拼接運算**、**成員運算**、**索引運算**、**切片運算**等操作，後面我們要講到的字串型別也支援這些運算，因為字串就是字元按一定順序構成的序列，在這一點上三者並沒有什麼區別。我們**推薦大家使用列表的生成式語法來建立列表**，它不僅好用而且效率很高，是 Python 語言中非常有特色的語法。
