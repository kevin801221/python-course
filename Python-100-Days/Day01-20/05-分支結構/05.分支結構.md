## 分支結構

迄今為止，我們寫的 Python 程式都是一條一條語句按順序向下執行的，這種程式碼結構叫做順序結構。然而僅有順序結構並不能解決所有的問題，比如我們設計一個遊戲，遊戲第一關的過關條件是玩家獲得 1000 分，那麼在第一關完成後，我們要根據玩家得到的分數來決定是進入第二關，還是告訴玩家“Game Over”（遊戲結束）。在這種場景下，我們的程式碼就會產生兩個分支，而且只有一個會被執行。類似的場景還有很多，我們將這種結構稱之為“分支結構”或“選擇結構”。給大家一分鐘的時間，你應該可以想到至少 5 個以上類似的例子，趕緊試一試吧！

### 使用if和else構造分支結構

在 Python 中，構造分支結構最常用的是`if`、`elif`和`else`三個關鍵字。所謂**關鍵字**就是程式語言中有特殊含義的單詞，很顯然你不能夠使用它作為變數名。當然，我們並不是每次構造分支結構都會把三個關鍵字全部用上，我們透過例子加以說明。例如我們要寫一個身體質量指數（BMI）的計算器。身體質量質數也叫體質指數，是國際上常用的衡量人體胖瘦程度以及是否健康的一個指標，計算公式如下所示。通常認為 $\small{18.5 \le BMI < 24}$ 是正常範圍， $\small{BMI < 18.5}$ 說明體重過輕， $\small{BMI \ge 24}$ 說明體重過重， $\small{BMI \ge 27}$ 就屬於肥胖的範疇了。

$$
BMI = \frac{體重}{身高^{2}}
$$

> **說明**：上面公式中的體重以千克（kg）為單位，身高以米（m）為單位。

```python
"""
BMI計算器

Version: 1.0
Author: Kevin
"""
height = float(input('身高(cm)：'))
weight = float(input('體重(kg)：'))
bmi = weight / (height / 100) ** 2
print(f'{bmi = :.1f}')
if 18.5 <= bmi < 24:
    print('你的身材很棒！')
```

> **提示**：`if`語句的最後面有一個`:`，它是用英文輸入法輸入的冒號；程式中輸入的`'`、`"`、`=`、`(`、`)`等特殊字元，都是在英文輸入法狀態下輸入的，這一點之前已經提醒過大家了。很多初學者經常會忽略這一點，等到執行程式碼時，就會看到一大堆錯誤提示。當然，認真讀一下錯誤提示還是很容易發現哪裡出了問題，但是**強烈建議**大家在寫程式碼的時候**切換到英文輸入法**，這樣可以避免很多不必要的麻煩。

上面的程式碼中，我們在計算和輸出 BMI 之後，加上了一段分支結構，如果滿足 $\small{18.5 \le BMI < 24}$ ，程式會輸出“你的身材很棒！”，但是如果不滿足條件，這段輸出就沒有了。這就是剛才提到的，程式碼可以有不同的執行路徑，有些程式碼不一定會執行到。我們在`if`關鍵字的後面給出了一個表示式`18.5 <= bmi < 24`，之前我們說過，關係運算會產生布林值，如果`if`後面的布林值為`True`，那麼`if`語句下方，有四個空格縮排的`print('你的身材很棒！')`就會被執行。我們先輸入幾組資料執行上面的程式碼，如下所示。

第一組輸入：

```
身高(cm)：175
體重(kg)：68
bmi = 22.2
你的身材很棒！
```

第二組輸入：

```
身高(cm)：175
體重(kg)：95
bmi = 31.0
```

第三組輸入：

```
身高(cm)：175
體重(kg)：50
bmi = 16.3
```

只有第一組輸入的身高和體重計算出的 BMI 在 18.5 到 24 這個範圍值內，所以觸發了`if`條件，輸出了“你的身材很棒”。需要說明的是，不同於 C、C++、Java 等程式語言，Python 中沒有用花括號來構造程式碼塊而是**使用縮排的方式來表示程式碼的層次結構**，如果`if`條件成立的情況下需要執行多條語句，只要保持多條語句具有相同的縮排就可以了。換句話說，若干行連續的語句如果保持了相同的縮排，那麼它們就屬於同一個**程式碼塊**，相當於是一個執行的整體。縮排可以使用任意數量的空格，但**通常使用4個空格**，強烈建議大家**不要使用製表鍵（Tab鍵）來縮排程式碼**，如果你已經習慣了這麼做，可以設定你的程式碼編輯器自動將 1 個製表鍵變成 4 個空格，很多程式碼編輯器都支援這項功能，PyCharm 中預設也是這樣設定的。還有一點，在 C、C++、Java 等程式語言中，`18.5 <= bmi < 24`要寫成兩個條件`bmi >= 18.5`和`bmi < 24`，然後把兩個條件用與運算子連線起來，Python 中也可以這麼做，例如剛才的`if`語句也可以寫成`if bmi >= 18.5 and bmi < 24:`，但是沒有必要，難道`if 18.5 <= bmi < 24:`這個寫法它不香嗎？下面用 Java 程式碼做了同樣的事情，看不懂 Java 程式碼沒關係，感受一下它和 Python 語法的區別就可以了。

```java
import java.util.Scanner;

class Test {

    public static void main(String[] args) {
        try (Scanner sc = new Scanner(System.in)) {
            System.out.print("身高(cm): ");
            double height = sc.nextDouble();
            System.out.print("體重(kg): ");
            double weight = sc.nextDouble();
            double bmi = weight / Math.pow(height / 100, 2);
            System.out.printf("bmi = %.1f\n", bmi);
            if (bmi >= 18.5 && bmi < 24) {
                System.out.println("你的身材很棒！");
            }
        }
    }
}
```

> **說明**：上面就是 BMI 計算器 1.0 版本對應的 Java 程式碼，很多人喜歡 Python 語言不是沒有道理的，通常它都能用更少的程式碼解決同樣的問題。

接下來，我們對上面的程式碼稍作修改，在 BMI 不滿足 $\small{18.5 \le BMI < 24}$ 的情況下，也給出相信的提示資訊。我們可以在`if`程式碼塊的後面增加一個`else`程式碼塊，它會在`if`語句給出的條件沒有達成時執行，如下所示。很顯然，`if`下面的`print('你的身材很棒！')`和`else`下面的`print('你的身材不夠標準喲！')`只有一個會被執行到。

```python
"""
BMI計算器

Version: 1.1
Author: Kevin
"""
height = float(input('身高(cm)：'))
weight = float(input('體重(kg)：'))
bmi = weight / (height / 100) ** 2
print(f'{bmi = :.1f}')
if 18.5 <= bmi < 24:
    print('你的身材很棒！')
else:
    print('你的身材不夠標準喲！')
```

如果要給出更為準確的提示資訊，我們可以再次修改上面的程式碼，透過`elif`關鍵字為上面的分支結構增加更多的分支，如下所示。

```python
"""
BMI計算器

Version: 1.2
Author: Kevin
"""
height = float(input('身高(cm)：'))
weight = float(input('體重(kg)：'))
bmi = weight / (height / 100) ** 2
print(f'{bmi = :.1f}')
if bmi < 18.5:
    print('你的體重過輕！')
elif bmi < 24:
    print('你的身材很棒！')
elif bmi < 27:
    print('你的體重過重！')
elif bmi < 30:
    print('你已輕度肥胖！')
elif bmi < 35:
    print('你已中度肥胖！')
else:
    print('你已重度肥胖！')
```

我們再用剛才的三組資料來測試下上面的程式碼，看看會得到怎樣的結果。

第一組輸入：

```
身高(cm)：175
體重(kg)：68
bmi = 22.2
你的身材很棒！
```

第二組輸入：

```
身高(cm)：175
體重(kg)：95
bmi = 31.0
你已中度肥胖！
```

第三組輸入：

```
身高(cm)：175
體重(kg)：50
bmi = 16.3
你的體重過輕！
```

### 使用match和case構造分支結構

Python 3.10 中增加了一種新的構造分支結構的方式，透過使用`match`和`case` 關鍵字，我們可以輕鬆的構造出多分支結構。Python 的官方文件在介紹這個新語法時，舉了一個 HTTP 響應狀態碼識別的例子（根據 HTTP 響應狀態輸出對應的描述），非常有意思。如果不知道什麼是 HTTP 響應狀態嗎，可以看看 MDN 上面的[文件](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)。下面我們對官方文件上的示例稍作修改，為大家講解這個語法，先看看下面用`if-else`結構實現的程式碼。

```python
status_code = int(input('響應狀態碼: '))
if status_code == 400:
    description = 'Bad Request'
elif status_code == 401:
    description = 'Unauthorized'
elif status_code == 403:
    description = 'Forbidden'
elif status_code == 404:
    description = 'Not Found'
elif status_code == 405:
    description = 'Method Not Allowed'
elif status_code == 418:
    description = 'I am a teapot'
elif status_code == 429:
    description = 'Too many requests'
else:
    description = 'Unknown status Code'
print('狀態碼描述:', description)
```

執行結果：

```
響應狀態碼: 403
狀態碼描述: Forbidden
```

下面是使用`match-case`語法實現的程式碼，雖然作用完全相同，但是程式碼顯得更加簡單優雅。

```python
status_code = int(input('響應狀態碼: '))
match status_code:
    case 400: description = 'Bad Request'
    case 401: description = 'Unauthorized'
    case 403: description = 'Forbidden'
    case 404: description = 'Not Found'
    case 405: description = 'Method Not Allowed'
    case 418: description = 'I am a teapot'
    case 429: description = 'Too many requests'
    case _: description = 'Unknown Status Code'
print('狀態碼描述:', description)
```

> **說明**：帶有`_`的`case`語句在程式碼中起到萬用字元的作用，如果前面的分支都沒有匹配上，程式碼就會來到`case _`。`case _`的是可選的，並非每種分支結構都要給出萬用字元選項。如果分支中出現了`case _`，它只能放在分支結構的最後面，如果它的後面還有其他的分支，那麼這些分支將是不可達的。

當然，`match-case`語法還有很多高階玩法，其中有一個合併模式可以先教給大家。例如，我們要將響應狀態碼`401`、`403`和`404`歸入一個分支，`400`和`405`歸入到一個分支，其他保持不變，程式碼還可以這麼寫。

```python
status_code = int(input('響應狀態碼: '))
match status_code:
    case 400 | 405: description = 'Invalid Request'
    case 401 | 403 | 404: description = 'Not Allowed'
    case 418: description = 'I am a teapot'
    case 429: description = 'Too many requests'
    case _: description = 'Unknown Status Code'
print('狀態碼描述:', description)
```

執行結果：

```
響應狀態碼: 403
狀態碼描述: Not Allowed
```

### 分支結構的應用

#### 例子1：分段函式求值

有如下所示的分段函式，要求輸入`x`，計算出`y`。

$$
y = \begin{cases} 3x - 5, & (x \gt 1) \\\\ x + 2, & (-1 \le x \le 1) \\\\ 5x + 3, & (x \lt -1) \end{cases}
$$

```python
"""
分段函式求值

Version: 1.0
Author: Kevin
"""
x = float(input('x = '))
if x > 1:
    y = 3 * x - 5
elif x >= -1:
    y = x + 2
else:
    y = 5 * x + 3
print(f'{y = }')
```

根據實際開發的需要，分支結構是可以巢狀的，也就是說在分支結構的`if`、`elif`或`else`程式碼塊中還可以再次引入分支結構。例如`if`條件成立表示玩家過關，但過關以後還要根據你獲得寶物或者道具的數量對你的表現給出評價（比如點亮一顆、兩顆或三顆星星），那麼我們就需要在`if`的內部再構造一個新的分支結構。同理，我們在`elif`和`else`中也可以構造新的分支，我們稱之為巢狀的分支結構。按照這樣的思路，上面的分段函式求值也可以用下面的程式碼來實現。

```python
"""
分段函式求值

Version: 1.1
Author: Kevin
"""
x = float(input('x = '))
if x > 1:
    y = 3 * x - 5
else:
    if x >= -1:
        y = x + 2
    else:
        y = 5 * x + 3
print(f'{y = }')
```

> **說明**：大家可以自己感受和評判一下上面兩種寫法哪一種更好。在“[**Python 之禪**](https://zhuanlan.zhihu.com/p/111843067)”中有這麼一句話：“**Flat is better than nested**”。之所以認為“扁平化”的程式碼更好，是因為程式碼巢狀的層次如果很多，會嚴重的影響程式碼的可讀性。所以，我個人更推薦大家使用第一種寫法。

#### 例子2：百分制成績轉換成等級

要求：如果輸入的成績在90分以上（含90分），則輸出`A`；輸入的成績在80分到90分之間（不含90分），則輸出`B`；輸入的成績在70分到80分之間（不含80分），則輸出`C`；輸入的成績在60分到70分之間（不含70分），則輸出`D`；輸入的成績在60分以下，則輸出`E`。

```python
"""
百分制成績轉換為等級製成績

Version: 1.0
Author: Kevin
"""
score = float(input('請輸入成績: '))
if score >= 90:
    grade = 'A'
elif score >= 80:
    grade = 'B'
elif score >= 70:
    grade = 'C'
elif score >= 60:
    grade = 'D'
else:
    grade = 'E'
print(f'{grade = }')
```
#### 例子3：計算三角形的周長和麵積。

要求：輸入三條邊的長度，如果能構成三角形就計算周長和麵積；否則給出“不能構成三角形”的提示。

```python
"""
計算三角形的周長和麵積

Version: 1.0
Author: Kevin
"""
a = float(input('a = '))
b = float(input('b = '))
c = float(input('c = '))
if a + b > c and a + c > b and b + c > a:
    perimeter = a + b + c
    print(f'周長: {perimeter}')
    s = perimeter / 2
    area = (s * (s - a) * (s - b) * (s - c)) ** 0.5
    print(f'面積: {area}')
else:
    print('不能構成三角形')
```
> **說明：** 上面的`if` 條件表示任意兩邊之和大於第三邊，這是構成三角形的必要條件。當這個條件成立時，我們要計算並輸出周長和麵積，所以`if`下方有五條語句都保持了相同的縮排，它們是一個整體，只要`if`條件成立，它們都會被執行，這就是我們之前提到的程式碼塊的概念。另外，上面計算三角形面積的公式叫做海倫公式，假設有一個三角形，邊長分別為 $\small{a}$ 、 $\small{b}$ 、 $\small{c}$ ，那麼三角的面積 $\small{A}$ 可以由公式 $\small{A = \sqrt{s(s-a)(s-b)(s-c)}}$ 得到，其中， $s=\frac{a + b + c}{2}$ 表示半周長。

### 總結

學會了 Python 中的分支結構和迴圈結構，我們就可以解決很多實際的問題了。這一節課相信已經幫助大家掌握了構造分支結構的方法，下一節課我們為大家介紹迴圈結構，學完這兩次課你一定會發現，你能寫出很多很有意思的程式碼，繼續加油吧！
