## 列表生成式與應用

### 列表生成式

在 Python 中，列表還可以透過一種特殊的字面量語法來建立，這種語法叫做生成式。下面，我們透過例子來說明使用列表生成式建立列表到底有什麼好處。

#### 場景一：篩選符合條件的數字

建立一個取值範圍在`1`到`99`且能被`3`或者`5`整除的數字構成的列表。

```python
items = []
for i in range(1, 100):
    if i % 3 == 0 or i % 5 == 0:
        items.append(i)
print(items)
```

使用列表生成式做同樣的事情，程式碼如下所示。

```python
items = [i for i in range(1, 100) if i % 3 == 0 or i % 5 == 0]
print(items)
```

#### 場景二：對元素進行運算

有一個整數列表`nums1`，建立一個新的列表`nums2`，`nums2`中的元素是`nums1`中對應元素的平方。

```python
nums1 = [35, 12, 97, 64, 55]
nums2 = []
for num in nums1:
    nums2.append(num ** 2)
print(nums2)
```

使用列表生成式做同樣的事情，程式碼如下所示。

```python
nums1 = [35, 12, 97, 64, 55]
nums2 = [num ** 2 for num in nums1]
print(nums2)
```

#### 場景三：篩選並提取元素

有一個整數列表`nums1`，建立一個新的列表`nums2`，將`nums1`中大於`50`的元素放到`nums2`中。

```python
nums1 = [35, 12, 97, 64, 55]
nums2 = []
for num in nums1:
    if num > 50:
        nums2.append(num)
print(nums2)
```

使用列表生成式做同樣的事情，程式碼如下所示。

```python
nums1 = [35, 12, 97, 64, 55]
nums2 = [num for num in nums1 if num > 50]
print(nums2)
```

使用列表生成式建立列表不僅程式碼簡單優雅，而且效能上也優於使用`for-in`迴圈和`append`方法向空列表中追加元素的方式。為什麼說生成式有更好的效能呢，那是因為 Python 直譯器的位元組碼指令中有專門針對生成式的指令（`LIST_APPEND`指令）；而`for`迴圈是透過方法呼叫（`LOAD_METHOD`和`CALL_METHOD`指令）的方式為列表新增元素，方法呼叫本身就是一個相對比較耗時的操作。對這一點不理解也沒有關係，記住"**強烈建議用生成式語法來建立列表**"這個結論就可以了。

### 巢狀列表

Python 語言沒有限定列表中的元素必須是相同的資料型別，也就是說一個列表中的元素可以任意的資料型別，當然也包括列表本身。如果列表中的元素也是列表，那麼我們可以稱之為巢狀的列表。巢狀的列表可以用來表示表格或數學上的矩陣，例如：我們想儲存5個學生3門課程的成績，可以用如下所示的列表。

```python
scores = [[95, 83, 92], [80, 75, 82], [92, 97, 90], [80, 78, 69], [65, 66, 89]]
print(scores[0])
print(scores[0][1])
```

對於上面的巢狀列表，每個元素相當於就是一個學生3門課程的成績，例如`[95, 83, 92]`，而這個列表中的`83`代表了這個學生某一門課的成績，如果想訪問這個值，可以使用兩次索引運算`scores[0][1]`，其中`scores[0]`可以得到`[95, 83, 92]`這個列表，再次使用索引運算`[1]`就可以獲得該列表中的第二個元素。

如果想透過鍵盤輸入的方式來錄入5個學生3門課程的成績並儲存在列表中，可以使用如下所示的程式碼。

```python
scores = []
for _ in range(5):
    temp = []
    for _ in range(3):
        score = int(input('請輸入: '))
        temp.append(score)
    scores.append(temp)
print(scores)
```

如果想透過產生隨機數的方式來生成5個學生3門課程的成績並儲存在列表中，我們可以使用列表生成式，程式碼如下所示。

```python
import random

scores = [[random.randrange(60, 101) for _ in range(3)] for _ in range(5)]
print(scores)
```

> **說明**：上面的程式碼`[random.randrange(60, 101) for _ in range(3)] `可以產生由3個隨機整數構成的列表，我們把這段程式碼又放在了另一個列表生成式中作為列表的元素，這樣的元素一共生成5個，最終得到了一個巢狀列表。

### 列表的應用

下面我們透過一個雙色球隨機選號的例子為大家講解列表的應用。雙色球是由中國福利彩票發行管理中心發售的樂透型彩票，每注投注號碼由`6`個紅色球和`1`個藍色球組成。紅色球號碼從`1`到`33`中選擇，藍色球號碼從`1`到`16`中選擇。每注需要選擇`6`個紅色球號碼和`1`個藍色球號碼，如下所示。

<img src="../../res/day09/lottery.png" style="zoom:85%;">

> **提示**：知乎上有一段對國內各種形式的彩票本質的論述相當精彩，這裡分享給大家："**虛構一個不勞而獲的人，去忽悠一群想不勞而獲的人，最終養活一批真正不勞而獲的人**"。很多對機率沒有概念的人，甚至認為彩票中與不中的機率都是 50%；還有很多人認為如果中獎的機率是 1%，那麼買 100 次就一定可以中獎，這些都是非常荒唐的想法。所以，**珍愛生命，遠離賭博，尤其是你對機率一無所知的情況下**！

下面，我們透過 Python 程式來生成一組隨機號碼。

```python
"""
雙色球隨機選號程式

Author: Kevin
Version: 1.0
"""
import random

red_balls = list(range(1, 34))
selected_balls = []
# 新增6個紅色球到選中列表
for _ in range(6):
    # 生成隨機整數代表選中的紅色球的索引位置
    index = random.randrange(len(red_balls))
    # 將選中的球從紅色球列表中移除並新增到選中列表
    selected_balls.append(red_balls.pop(index))
# 對選中的紅色球排序
selected_balls.sort()
# 輸出選中的紅色球
for ball in selected_balls:
    print(f'\033[031m{ball:0>2d}\033[0m', end=' ')
# 隨機選擇1個藍色球
blue_ball = random.randrange(1, 17)
# 輸出選中的藍色球
print(f'\033[034m{blue_ball:0>2d}\033[0m')
```

> **說明**：上面程式碼中`print(f'\033[0m...\033[0m')`是為了控制輸出內容的顏色，紅色球輸出成紅色，藍色球輸出成藍色。其中省略號代表我們要輸出的內容，`\033[0m`是一個控制碼，表示關閉所有屬性，也就是說之前的控制碼將會失效，你也可以將其簡單的理解為一個定界符，`m`前面的`0`表示控制檯的顯示方式為預設值，`0`可以省略，`1`表示高亮，`5`表示閃爍，`7`表示反顯等。在`0`和`m`的中間，我們可以寫上代表顏色的數字，比如`30`代表黑色，`31`代表紅色，`32`代表綠色，`33`代表黃色，`34`代表藍色等。

我們還可以利用`random`模組提供的`sample`和`choice`函式來簡化上面的程式碼，前者可以實現無放回隨機抽樣，後者可以實現隨機抽取一個元素，修改後的程式碼如下所示。

```python
"""
雙色球隨機選號程式

Author: Kevin
Version: 1.1
"""
import random

red_balls = [i for i in range(1, 34)]
blue_balls = [i for i in range(1, 17)]
# 從紅色球列表中隨機抽出6個紅色球（無放回抽樣）
selected_balls = random.sample(red_balls, 6)
# 對選中的紅色球排序
selected_balls.sort()
# 輸出選中的紅色球
for ball in selected_balls:
    print(f'\033[031m{ball:0>2d}\033[0m', end=' ')
# 從藍色球列表中隨機抽出1個藍色球
blue_ball = random.choice(blue_balls)
# 輸出選中的藍色球
print(f'\033[034m{blue_ball:0>2d}\033[0m')
```

如果要實現隨機生成`N`注號碼，我們只需要將上面的程式碼放到一個`N`次的迴圈中，如下所示。

```python
"""
雙色球隨機選號程式

Author: Kevin
Version: 1.2
"""
import random

n = int(input('生成幾注號碼: '))
red_balls = [i for i in range(1, 34)]
blue_balls = [i for i in range(1, 17)]
for _ in range(n):
    # 從紅色球列表中隨機抽出6個紅色球（無放回抽樣）
    selected_balls = random.sample(red_balls, 6)
    # 對選中的紅色球排序
    selected_balls.sort()
    # 輸出選中的紅色球
    for ball in selected_balls:
        print(f'\033[031m{ball:0>2d}\033[0m', end=' ')
    # 從藍色球列表中隨機抽出1個藍色球
    blue_ball = random.choice(blue_balls)
    # 輸出選中的藍色球
    print(f'\033[034m{blue_ball:0>2d}\033[0m')
```

<img src="../../res/day09/lottery_run_result.png" style="zoom:35%;">

### 總結

Python 中的列表底層是一個可以動態擴容的陣列，列表元素在計算機記憶體中是連續儲存的，所以可以實現隨機訪問（透過一個有效的索引獲取對應的元素且操作時間與列表元素個數無關）。

列表的核心知識點：

1. **列表生成式**：簡潔高效地建立列表
2. **巢狀列表**：可以表示表格或矩陣
3. **random 模組**：`sample`用於無放回抽樣，`choice`用於隨機選擇一個元素

我們可以暫時不去觸碰這些底層的儲存細節，也不需要大家理解列表每個方法的漸近時間複雜度（執行方法耗費的時間跟列表元素個數之間的關係），大家先學會用列表解決工作中的問題，我想這一點更為重要。
