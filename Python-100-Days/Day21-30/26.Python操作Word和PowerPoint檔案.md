## Python操作Word和PowerPoint檔案

在日常工作中，有很多簡單重複的勞動其實完全可以交給 Python 程式，比如根據樣板檔案（模板檔案）批次的生成很多個 Word 檔案或 PowerPoint 檔案。Word 是微軟公司開發的文書處理程式，相信大家都不陌生，日常辦公中很多正式的文件都是用 Word 進行撰寫和編輯的，目前使用的 Word 檔案字尾名一般為`.docx`。PowerPoint 是微軟公司開發的簡報程式，是微軟的 Office 系列軟體中的一員，被商業人士、教師、學生等群體廣泛使用，通常也將其稱之為“幻燈片”。在 Python 中，可以使用名為`python-docx` 的三方庫來操作 Word，可以使用名為`python-pptx`的三方庫來生成 PowerPoint。

### 操作Word文件

我們可以先透過下面的命令來安裝`python-docx`三方庫。

```bash
pip install python-docx
```

按照[官方文件](https://python-docx.readthedocs.io/en/latest/)的介紹，我們可以使用如下所示的程式碼來生成一個簡單的 Word 文件。

```python
from docx import Document
from docx.shared import Cm, Pt

from docx.document import Document as Doc

# 建立代表Word文件的Doc物件
document = Document()  # type: Doc
# 新增大標題
document.add_heading('快快樂樂學Python', 0)
# 新增段落
p = document.add_paragraph('Python是一門非常流行的程式語言，它')
run = p.add_run('簡單')
run.bold = True
run.font.size = Pt(18)
p.add_run('而且')
run = p.add_run('優雅')
run.font.size = Pt(18)
run.underline = True
p.add_run('。')

# 新增一級標題
document.add_heading('Heading, level 1', level=1)
# 新增帶樣式的段落
document.add_paragraph('Intense quote', style='Intense Quote')
# 新增無序列表
document.add_paragraph(
    'first item in unordered list', style='List Bullet'
)
document.add_paragraph(
    'second item in ordered list', style='List Bullet'
)
# 新增有序列表
document.add_paragraph(
    'first item in ordered list', style='List Number'
)
document.add_paragraph(
    'second item in ordered list', style='List Number'
)

# 新增圖片（注意路徑和圖片必須要存在）
document.add_picture('resources/guido.jpg', width=Cm(5.2))

# 新增分節符
document.add_section()

records = (
    ('Kevin', '男', '1995-5-5'),
    ('孫美麗', '女', '1992-2-2')
)
# 新增表格
table = document.add_table(rows=1, cols=3)
table.style = 'Dark List'
hdr_cells = table.rows[0].cells
hdr_cells[0].text = '姓名'
hdr_cells[1].text = '性別'
hdr_cells[2].text = '出生日期'
# 為表格新增行
for name, sex, birthday in records:
    row_cells = table.add_row().cells
    row_cells[0].text = name
    row_cells[1].text = sex
    row_cells[2].text = birthday

# 新增分頁符
document.add_page_break()

# 儲存文件
document.save('demo.docx')
```

> **提示**：上面程式碼第7行中的註釋`# type: Doc`是為了在PyCharm中獲得程式碼補全提示，因為如果不清楚物件具體的資料型別，PyCharm 無法在後續程式碼中給出`Doc`物件的程式碼補全提示。

執行上面的程式碼，開啟生成的 Word 文件，效果如下圖所示。

<img src="res/20210820002742.png" width="40%">&nbsp;&nbsp;<img src="res/20210820002843.png" width="40%">

對於一個已經存在的 Word 檔案，我們可以透過下面的程式碼去遍歷它所有的段落並獲取對應的內容。

```python
from docx import Document
from docx.document import Document as Doc

doc = Document('resources/離職證明.docx')  # type: Doc
for no, p in enumerate(doc.paragraphs):
    print(no, p.text)
```

> **提示**：如果需要上面程式碼中的 Word 檔案，可以透過下面的百度雲盤地址進行獲取。連結:https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g 提取碼:e7b4。

讀取到的內容如下所示。

```
0 
1 離 職 證 明
2 
3 茲證明 王大錘 ，身份證號碼： 100200199512120001 ，於 2018 年 8 月 7 日至 2020 年 6 月 28 日在我單位  開發部 部門擔任 Java開發工程師 職務，在職期間無不良表現。因 個人 原因，於 2020 年 6 月 28 日起終止解除勞動合同。現已結清財務相關費用，辦理完解除勞動關係相關手續，雙方不存在任何勞動爭議。
4 
5 特此證明！
6 
7 
8 公司名稱（蓋章）:成都風車車科技有限公司
9    			2020 年 6 月 28 日
```

講到這裡，相信很多讀者已經想到了，我們可以把上面的離職證明製作成一個模板檔案，把姓名、身份證號、入職和離職日期等資訊用佔位符代替，這樣透過對佔位符的替換，就可以根據實際需要寫入對應的資訊，這樣就可以批次的生成 Word 文件。

按照上面的思路，我們首先編輯一個離職證明的模板檔案，如下圖所示。

<img src="res/20210820004223.png" width="75%" style="border:1px solid black"/>

接下來我們讀取該檔案，將佔位符替換為真實資訊，就可以生成一個新的 Word 文件，如下所示。

```python
from docx import Document
from docx.document import Document as Doc

# 將真實資訊用字典的方式儲存在列表中
employees = [
    {
        'name': 'Kevin',
        'id': '100200198011280001',
        'sdate': '2008年3月1日',
        'edate': '2012年2月29日',
        'department': '產品研發',
        'position': '架構師',
        'company': '成都華為技術有限公司'
    },
    {
        'name': '王大錘',
        'id': '510210199012125566',
        'sdate': '2019年1月1日',
        'edate': '2021年4月30日',
        'department': '產品研發',
        'position': 'Python開發工程師',
        'company': '成都穀道科技有限公司'
    },
    {
        'name': '李元芳',
        'id': '2102101995103221599',
        'sdate': '2020年5月10日',
        'edate': '2021年3月5日',
        'department': '產品研發',
        'position': 'Java開發工程師',
        'company': '同城企業管理集團有限公司'
    },
]
# 對列表進行迴圈遍歷，批次生成Word文件 
for emp_dict in employees:
    # 讀取離職證明模板檔案
    doc = Document('resources/離職證明模板.docx')  # type: Doc
    # 迴圈遍歷所有段落尋找佔位符
    for p in doc.paragraphs:
        if '{' not in p.text:
            continue
        # 不能直接修改段落內容，否則會丟失樣式
        # 所以需要對段落中的元素進行遍歷並進行查詢替換
        for run in p.runs:
            if '{' not in run.text:
                continue
            # 將佔位符換成實際內容
            start, end = run.text.find('{'), run.text.find('}')
            key, place_holder = run.text[start + 1:end], run.text[start:end + 1]
            run.text = run.text.replace(place_holder, emp_dict[key])
    # 每個人對應儲存一個Word文件
    doc.save(f'{emp_dict["name"]}離職證明.docx')
```

執行上面的程式碼，會在當前路徑下生成三個 Word 文件，如下圖所示。

<img src="res/20210820004825.png" width="50%">

### 生成PowerPoint

首先我們需要安裝名為`python-pptx`的三方庫，命令如下所示。

```Bash
pip install python-pptx
```

用 Python 操作 PowerPoint 的內容，因為實際應用場景不算很多，我不打算在這裡進行贅述，有興趣的讀者可以自行閱讀`python-pptx`的[官方文件](https://python-pptx.readthedocs.io/en/latest/)，下面僅展示一段來自於官方文件的程式碼。

```python
from pptx import Presentation

# 建立幻燈片物件
pres = Presentation()

# 選擇母版新增一頁
title_slide_layout = pres.slide_layouts[0]
slide = pres.slides.add_slide(title_slide_layout)
# 獲取標題欄和副標題欄
title = slide.shapes.title
subtitle = slide.placeholders[1]
# 編輯標題和副標題
title.text = "Welcome to Python"
subtitle.text = "Life is short, I use Python"

# 選擇母版新增一頁
bullet_slide_layout = pres.slide_layouts[1]
slide = pres.slides.add_slide(bullet_slide_layout)
# 獲取頁面上所有形狀
shapes = slide.shapes
# 獲取標題和主體
title_shape = shapes.title
body_shape = shapes.placeholders[1]
# 編輯標題
title_shape.text = 'Introduction'
# 編輯主體內容
tf = body_shape.text_frame
tf.text = 'History of Python'
# 新增一個一級段落
p = tf.add_paragraph()
p.text = 'X\'max 1989'
p.level = 1
# 新增一個二級段落
p = tf.add_paragraph()
p.text = 'Guido began to write interpreter for Python.'
p.level = 2

# 儲存幻燈片
pres.save('test.pptx')
```

執行上面的程式碼，生成的 PowerPoint 檔案如下圖所示。

<img src="res/20210820010306.png" width="75%" />

### 總結

用 Python 程式解決辦公自動化的問題真的非常酷，它可以將我們從繁瑣乏味的勞動中解放出來。寫這類程式碼就是去做一件一勞永逸的事情，寫程式碼的過程即便不怎麼愉快，使用這些程式碼的時候應該是非常開心的。
