## Python讀寫CSV檔案

### CSV檔案介紹

CSV（Comma Separated Values）全稱逗號分隔值檔案是一種簡單、通用的檔案格式，被廣泛的應用於應用程式（資料庫、電子表格等）資料的匯入和匯出以及異構系統之間的資料交換。因為CSV是純文字檔案，不管是什麼作業系統和程式語言都是可以處理純文字的，而且很多程式語言中都提供了對讀寫CSV檔案的支援，因此CSV格式在資料處理和資料科學中被廣泛應用。

CSV檔案有以下特點：

1. 純文字，使用某種字符集（如[ASCII](https://zh.wikipedia.org/wiki/ASCII)、[Unicode](https://zh.wikipedia.org/wiki/Unicode)、[GB2312](https://zh.wikipedia.org/wiki/GB2312)）等）；
2. 由一條條的記錄組成（典型的是每行一條記錄）；
3. 每條記錄被分隔符（如逗號、分號、製表符等）分隔為欄位（列）；
4. 每條記錄都有同樣的欄位序列。

CSV檔案可以使用文字編輯器或類似於Excel電子表格這類工具開啟和編輯，當使用Excel這類電子表格開啟CSV檔案時，你甚至感覺不到CSV和Excel檔案的區別。很多資料庫系統都支援將資料匯出到CSV檔案中，當然也支援從CSV檔案中讀入資料儲存到資料庫中，這些內容並不是現在要討論的重點。

### 將資料寫入CSV檔案

現有五個學生三門課程的考試成績需要儲存到一個CSV檔案中，要達成這個目標，可以使用Python標準庫中的`csv`模組，該模組的`writer`函式會返回一個`csvwriter`物件，透過該物件的`writerow`或`writerows`方法就可以將資料寫入到CSV檔案中，具體的程式碼如下所示。

```python
import csv
import random

with open('scores.csv', 'w') as file:
    writer = csv.writer(file)
    writer.writerow(['姓名', '語文', '數學', '英語'])
    names = ['關羽', '張飛', '趙雲', '馬超', '黃忠']
    for name in names:
        scores = [random.randrange(50, 101) for _ in range(3)]
        scores.insert(0, name)
        writer.writerow(scores)
```

生成的CSV檔案的內容。

```
姓名,語文,數學,英語
關羽,98,86,61
張飛,86,58,80
趙雲,95,73,70
馬超,83,97,55
黃忠,61,54,87
```

需要說明的是上面的`writer`函式，除了傳入要寫入資料的檔案物件外，還可以`dialect`引數，它表示CSV檔案的方言，預設值是`excel`。除此之外，還可以透過`delimiter`、`quotechar`、`quoting`引數來指定分隔符（預設是逗號）、包圍值的字元（預設是雙引號）以及包圍的方式。其中，包圍值的字元主要用於當欄位中有特殊符號時，透過新增包圍值的字元可以避免二義性。大家可以嘗試將上面第5行程式碼修改為下面的程式碼，然後檢視生成的CSV檔案。

```python
writer = csv.writer(file, delimiter='|', quoting=csv.QUOTE_ALL)
```

生成的CSV檔案的內容。

```
"姓名"|"語文"|"數學"|"英語"
"關羽"|"88"|"64"|"65"
"張飛"|"76"|"93"|"79"
"趙雲"|"78"|"55"|"76"
"馬超"|"72"|"77"|"68"
"黃忠"|"70"|"72"|"51"
```

### 從CSV檔案讀取資料

如果要讀取剛才建立的CSV檔案，可以使用下面的程式碼，透過`csv`模組的`reader`函式可以建立出`csvreader`物件，該物件是一個迭代器，可以透過`next`函式或`for-in`迴圈讀取到檔案中的資料。

```python
import csv

with open('scores.csv', 'r') as file:
    reader = csv.reader(file, delimiter='|')
    for data_list in reader:
        print(reader.line_num, end='\t')
        for elem in data_list:
            print(elem, end='\t')
        print()
```

> **注意**：上面的程式碼對`csvreader`物件做`for`迴圈時，每次會取出一個列表物件，該列表物件包含了一行中所有的欄位。

###  總結

將來如果大家使用Python做資料分析，很有可能會用到名為`pandas`的三方庫，它是Python資料分析的神器之一。`pandas`中封裝了名為`read_csv`和`to_csv`的函式用來讀寫CSV檔案，其中`read_CSV`會將讀取到的資料變成一個`DataFrame`物件，而`DataFrame`就是`pandas`庫中最重要的型別，它封裝了一系列用於資料處理的方法（清洗、轉換、聚合等）；而`to_csv`會將`DataFrame`物件中的資料寫入CSV檔案，完成資料的持久化。`read_csv`函式和`to_csv`函式遠遠比原生的`csvreader`和`csvwriter`強大。
