## Python操作PDF檔案

PDF 是 Portable Document Format 的縮寫，這類檔案通常使用`.pdf`作為其副檔名。在日常開發工作中，最容易遇到的就是從 PDF 中讀取文字內容以及用已有的內容生成PDF文件這兩個任務。

### 從PDF中提取文字

在 Python 中，可以使用名為`PyPDF2`的三方庫來讀取 PDF 檔案，可以使用下面的命令來安裝它。

```Bash
pip install PyPDF2
```

`PyPDF2`沒有辦法從 PDF 文件中提取影象、圖表或其他媒體，但它可以提取文字，並將其返回為 Python 字串。

```python
import PyPDF2

reader = PyPDF2.PdfReader('test.pdf')
for page in reader.pages:
    print(page.extract_text())
```

> **提示**：本章程式碼使用到的 PDF 檔案都可以透過下面的百度雲盤地址進行獲取，連結：https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取碼：e7b4。

當然，`PyPDF2`並不是什麼樣的 PDF 文件都能提取出文字來，這個問題就我所知並沒有什麼特別好的解決方法，尤其是在提取中文的時候。網上也有很多講解從 PDF 中提取文字的文章，推薦大家自行閱讀[《三大神器助力Python提取pdf文件資訊》](https://cloud.tencent.com/developer/article/1395339)一文進行了解。

要從 PDF 檔案中提取文字也可以直接使用三方的命令列工具，具體的做法如下所示。

```Bash
pip install pdfminer.six
pdf2text.py test.pdf
```

### 旋轉和疊加頁面

上面的程式碼中透過建立`PdfFileReader`物件的方式來讀取 PDF 文件，該物件的`getPage`方法可以獲得PDF文件的指定頁並得到一個`PageObject`物件，透過`PageObject`物件的`rotateClockwise`和`rotateCounterClockwise`方法可以實現頁面的順時針和逆時針方向旋轉，透過`PageObject`物件的`addBlankPage`方法可以新增一個新的空白頁，程式碼如下所示。

```python
reader = PyPDF2.PdfReader('XGBoost.pdf')
writer = PyPDF2.PdfWriter()

for no, page in enumerate(reader.pages):
    if no % 2 == 0:
        new_page = page.rotate(-90)
    else:
        new_page = page.rotate(90)
    writer.add_page(new_page)

with open('temp.pdf', 'wb') as file_obj:
    writer.write(file_obj)
```

### 加密PDF檔案

使用`PyPDF2`中的`PdfFileWrite`物件可以為PDF文件加密，如果需要給一系列的PDF文件設定統一的訪問口令，使用Python程式來處理就會非常的方便。

```python
import PyPDF2

reader = PyPDF2.PdfReader('XGBoost.pdf')
writer = PyPDF2.PdfWriter()

for page in reader.pages:
    writer.add_page(page)
    
writer.encrypt('foobared')

with open('temp.pdf', 'wb') as file_obj:
    writer.write(file_obj)
```

### 批次新增水印

上面提到的`PageObject`物件還有一個名為`mergePage`的方法，可以兩個 PDF 頁面進行疊加，透過這個操作，我們很容易實現給PDF檔案新增水印的功能。例如要給上面的“XGBoost.pdf”檔案新增一個水印，我們可以先準備好一個提供水印頁面的 PDF 檔案，然後將包含水印的`PageObject`讀取出來，然後再迴圈遍歷“XGBoost.pdf”檔案的每個頁，獲取到`PageObject`物件，然後透過`mergePage`方法實現水印頁和原始頁的合併，程式碼如下所示。

```python
reader1 = PyPDF2.PdfReader('XGBoost.pdf')
reader2 = PyPDF2.PdfReader('watermark.pdf')
writer = PyPDF2.PdfWriter()
watermark_page = reader2.pages[0]

for page in reader1.pages:
    page.merge_page(watermark_page)
    writer.add_page(page)

with open('temp.pdf', 'wb') as file_obj:
    writer.write(file_obj)
```

如果願意，還可以讓奇數頁和偶數頁使用不同的水印，大家可以自己思考下應該怎麼做。

### 建立PDF檔案

建立 PDF 文件需要三方庫`reportlab`的支援，安裝的方法如下所示。

```Bash
pip install reportlab
```

下面透過一個例子為大家展示`reportlab`的用法。

```python
from reportlab.lib.pagesizes import A4
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.pdfgen import canvas

pdf_canvas = canvas.Canvas('resources/demo.pdf', pagesize=A4)
width, height = A4

# 繪圖
image = canvas.ImageReader('resources/guido.jpg')
pdf_canvas.drawImage(image, 20, height - 395, 250, 375)

# 顯示當前頁
pdf_canvas.showPage()

# 註冊字型檔案
pdfmetrics.registerFont(TTFont('Font1', 'resources/fonts/Vera.ttf'))
pdfmetrics.registerFont(TTFont('Font2', 'resources/fonts/青呱石頭體.ttf'))

# 寫字
pdf_canvas.setFont('Font2', 40)
pdf_canvas.setFillColorRGB(0.9, 0.5, 0.3, 1)
pdf_canvas.drawString(width // 2 - 120, height // 2, '你好，世界！')
pdf_canvas.setFont('Font1', 40)
pdf_canvas.setFillColorRGB(0, 1, 0, 0.5)
pdf_canvas.rotate(18)
pdf_canvas.drawString(250, 250, 'hello, world!')

# 儲存
pdf_canvas.save()
```

上面的程式碼如果不太理解也沒有關係，等真正需要用 Python 建立 PDF 文件的時候，再好好研讀一下`reportlab`的[官方文件](https://www.reportlab.com/docs/reportlab-userguide.pdf)就可以了。

> **提示**：上面程式碼中用到的圖片和字型可以透過下面的百度雲盤連結獲取，連結：https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取碼：e7b4。

###  總結

在學習完上面的內容之後，相信大家已經知道像合併多個 PDF 檔案這樣的工作應該如何用 Python 程式碼來處理了，趕緊自己動手試一試吧。
